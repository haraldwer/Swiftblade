#include "Shaders/Uniforms/SH_FrameUniforms.si"
#include "Shaders/Uniforms/SH_TexUniforms.si"
#include "Shaders/Utility/SH_CubeSampling.si"

#include "Shaders/PBR/SH_PBR_ConvoluteIrradiance.si"
#include "Shaders/PBR/SH_PBR_Prefilter.si"

in vec2 TexCoord;
in vec2 RectCoord;

out vec4 OutIrradiance;
out vec4 OutPrefilter;

void main()
{
    vec2 texel = vec2(1) / Resolution;
    
    vec3 worldPos = SampleWorldPos(TexCoord).xyz;
    vec3 camDiff = CameraPosition - worldPos.xyz;
    vec3 camDir = normalize(camDiff);
    
    OutIrradiance.rgb = ConvoluteIrradiance(TexFrame, texel, RefRect, camDir);
    OutPrefilter.rgb = Prefilter(TexFrame, texel, RefRect, camDir, 0.5);
    
    OutIrradiance.a = 1;
    OutPrefilter.a = 1;
}
