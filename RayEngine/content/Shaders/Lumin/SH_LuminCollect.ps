#include "Shaders/Uniforms/SH_FrameUniforms.si"
#include "Shaders/Uniforms/SH_TexUniforms.si"
#include "Shaders/Utility/SH_CubeSampling.si"

#include "Shaders/PBR/SH_PBR_ConvoluteIrradiance.si"
#include "Shaders/PBR/SH_PBR_Prefilter.si"

in vec2 TexCoord;
in vec2 RectCoord;

out vec4 OutIrradiance;
out vec3 OutPrefilter;

void main()
{
    vec2 texel = vec2(1) / Resolution;
    
    vec3 worldPos = SampleWorldPos(TexCoord).xyz;
    vec3 camDiff = worldPos.xyz - CameraPosition;
    float camDist = length(camDiff);
    vec3 camDir = camDiff / camDist;
    
    OutIrradiance.rgb = ConvoluteIrradiance(TexFrame, texel, RefRect, camDir);
    OutPrefilter.rgb = Prefilter(TexFrame, texel, RefRect, camDir, 1.0);
    
    OutIrradiance.a = camDist / NearFar.y;
}
