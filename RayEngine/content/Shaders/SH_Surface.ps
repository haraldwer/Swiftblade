
#include "Shaders/Uniforms/SH_FrameUniforms.si"
#include "Shaders/Uniforms/SH_TexUniforms.si"

#include "Shaders/Utility/SH_Utility.si"
#include "Shaders/Utility/SH_DeferredID.si"

#include "Shaders/PBR/SH_PBR.si"

in vec2 TexCoord;
in vec2 RectCoord;

layout (location = 0) out vec4 Output; // rgb - Color, a - Depth

void main()
{
    vec4 albedo = SampleAlbedo(TexCoord);
    vec4 worldPosition = SampleWorldPos(TexCoord);
    
    Output.rgb = albedo.rgb;
    Output.a = worldPosition.w;
    
    if (albedo.a > 0.99f)
        return;
    
    vec3 worldNormal = SampleNormal(TexCoord);
    vec3 surface = SampleSurface(TexCoord);
    vec3 pbr = PBR(worldPosition.xyz, worldNormal, albedo.rgb, surface);
    
    Output.rgb = mix(pbr, albedo.rgb, albedo.a);
}